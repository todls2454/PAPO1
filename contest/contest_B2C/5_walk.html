<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÇ∞Ï±ÖÍ∏∏ Ï∂îÏ≤ú</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #FEFDF6;
            width: 100vw;
            height: 100vh;
            overflow-x: hidden;
        }

        .frame {
            width: 393px;
            margin: 0 auto;
            background-color: #FEFDF6;
            position: relative;
            min-height: 100vh;
            padding-bottom: 65px; 
        }

        .top-bar {
            padding: 20px 14px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .top-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 16px;
            color: #000;
        }

        .back-btn {
            position: absolute;
            left: 14px;
            font-size: 24px;
            cursor: pointer;
            color: #000;
        }
        
        .trail-recommendation {
            padding: 20px 14px 0;
        }

        .trail-title-container {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .trail-icon {
            font-size: 20px;
            margin-right: 8px;
        }

        .trail-main-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 17px;
            color: #4B352A;
        }

        .trail-subtitle {
            font-family: 'Pretendard', sans-serif;
            font-weight: 500;
            font-size: 13px;
            color: #000;
        }

        #map {
            width: 100%;
            height: 300px;
            margin-top: 15px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }

        .list-section {
            padding: 20px 14px;
        }

        .section-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 15px;
            color: #000;
            margin-bottom: 15px;
        }
        
        .trail-card {
            display: flex;
            background: #FFFFFF;
            border-radius: 7px;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            padding: 10px;
            margin-bottom: 15px;
            align-items: center;
            cursor: pointer;
        }
        
        .trail-card-image {
            width: 70px;
            height: 70px;
            border-radius: 5px;
            object-fit: cover;
            margin-right: 15px;
        }

        .trail-card-content {
            flex-grow: 1;
        }

        .card-title {
            font-family: 'Pretendard', sans-serif;
            font-weight: 700;
            font-size: 15px;
            color: #000;
            margin-bottom: 5px;
        }
        
        .card-info {
            display: flex;
            align-items: center;
            font-family: 'Pretendard', sans-serif;
            font-weight: 500;
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .card-info span {
            margin-right: 10px;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tag {
            font-family: 'Pretendard', sans-serif;
            font-weight: 500;
            font-size: 11px;
            color: #CA7842;
            background-color: #F8EFE5;
            padding: 4px 8px;
            border-radius: 15px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 393px;
            height: 65px;
            background: #FFFFFF;
            border-top: 1px solid #E0E0E0;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            flex: 1;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            font-size: 20px;
        }

        .nav-text {
            font-family: 'Pretendard';
            font-weight: 400;
            font-size: 12px;
            color: #000;
        }

        .nav-text.active {
            color: #4B352A;
        }
    </style>
</head>
<body>
    <div class="frame">
        <div class="top-bar">
            <span class="back-btn" onclick="history.back()">‚Üê</span>
            <div class="top-title">ÏÇ∞Ï±ÖÍ∏∏ Ï∂îÏ≤ú</div>
        </div>

        <div class="trail-recommendation">
            <div class="trail-title-container">
                <span class="trail-icon">üêï</span>
                <div class="trail-main-title">Î∞òÎ†§Í≤¨Í≥º Ìï®Íªò Í±∑Í∏∞ Ï¢ãÏùÄ ÏÇ∞Ï±ÖÍ∏∏</div>
            </div>
            <div class="trail-subtitle">2025ÎÖÑ 6Ïõî 20Ïùº Í∏∞Ï§Ä Ï∂îÏ≤ú Í≤ΩÎ°ú</div>
        </div>
        
        <div id="map"></div>

        <div class="list-section">
            <div class="section-title">ÎÇ¥ Ï£ºÎ≥Ä ÏÇ∞Ï±ÖÍ∏∏</div>
            <div id="trail-list">
                </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item">
                <div class="nav-icon">üè†</div>
                <div class="nav-text">Ìôà</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">‚ù§Ô∏è</div>
                <div class="nav-text">ÏûÖÏñë</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">‚ûï</div>
                <div class="nav-text">Îì±Î°ù</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">üí¨</div>
                <div class="nav-text">Ï†úÎ≥¥</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-text">ÏÑ§Ï†ï</div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=getUserLocation`;
            script.async = true;
            document.head.appendChild(script);
        })();

        let map;

        const randomTags = [
            ['Î∞òÎ†§Í≤¨ Í∞ÄÎä•', 'ÌèâÏßÄ'],
            ['Í≤ΩÏπò Ï¢ãÏùå', 'ÏÇ¨ÏßÑ Ï∞çÍ∏∞ Ï¢ãÏùå'],
            ['Ìé∏ÏùòÏãúÏÑ§ ÏûàÏùå', 'Î≤§Ïπò ÏûàÏùå'],
            ['Í≤ΩÏÇ¨ ÏûàÏùå', 'Ïö¥Îèô ÏΩîÏä§'],
            ['Ïó≠ÏÇ¨Ï†Å Ïû•ÏÜå'],
            ['Îç∞Ïù¥Ìä∏ ÏΩîÏä§', 'Ìò∏Ïàò Ï†ÑÎßù']
        ];

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        initMap(userLocation);
                    },
                    (error) => {
                        console.error('ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:', error);
                        const defaultLocation = { lat: 35.85695, lng: 128.56157 };
                        initMap(defaultLocation);
                    }
                );
            } else {
                const defaultLocation = { lat: 35.85695, lng: 128.56157 };
                initMap(defaultLocation);
            }
        }

        function initMap(center) {
            map = new google.maps.Map(document.getElementById('map'), {
                center: center,
                zoom: 15,
                disableDefaultUI: true,
            });
            new google.maps.Marker({
                position: center,
                map: map,
                title: 'ÎÇ¥ ÏúÑÏπò',
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                }
            });
            fetchTrails(center);
        }
        
        function fetchTrails(userLocation) {
            fetch('forest_trails.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ÎÑ§Ìä∏ÏõåÌÅ¨ ÏùëÎãµÏóê Î¨∏Ï†úÍ∞Ä ÏûàÏäµÎãàÎã§.');
                    }
                    return response.json();
                })
                .then(data => {
                    const trailsWithDistance = data.map(trail => ({
                        ...trail,
                        distance: haversine(userLocation.lat, userLocation.lng, trail.ÏúÑÎèÑ, trail.Í≤ΩÎèÑ)
                    }));
                    
                    trailsWithDistance.sort((a, b) => a.distance - b.distance);
                    
                    const closestTrails = trailsWithDistance.slice(0, 2);
                    
                    renderAllMarkers(data); 
                    renderTrailList(closestTrails);
                })
                .catch(error => {
                    console.error('JSON Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:', error);
                    document.getElementById('trail-list').innerHTML = '<p>ÏÇ∞Ï±ÖÍ∏∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p>';
                });
        }
        
        function renderAllMarkers(trails) {
            trails.forEach(trail => {
                new google.maps.Marker({
                    position: { lat: trail.ÏúÑÎèÑ, lng: trail.Í≤ΩÎèÑ },
                    map: map,
                    title: trail.Ïû•ÏÜåÎ™Ö
                });
            });
        }

        function renderTrailList(trails) {
            const trailListContainer = document.getElementById('trail-list');
            trailListContainer.innerHTML = '';
            
            const imagePaths = ['img/walk1.png', 'img/walk2.png'];
            let imageIndex = 0;

            trails.forEach(trail => {
                const card = document.createElement('div');
                card.className = 'trail-card';
                
                const selectedTags = randomTags[Math.floor(Math.random() * randomTags.length)];
                const tagsHtml = selectedTags.map(tag => `<span class="tag">${tag}</span>`).join('');
                
                const image = imagePaths[imageIndex % imagePaths.length];
                imageIndex++;
                
                const formattedDistance = `${trail.distance.toFixed(1)}km`;
                
                card.innerHTML = `
                    <img src="${image}" alt="${trail.Ïû•ÏÜåÎ™Ö} Ïù¥ÎØ∏ÏßÄ" class="trail-card-image">
                    <div class="trail-card-content">
                        <div class="card-title">${trail.Ïà≤Í∏∏Î™Ö}</div>
                        <div class="card-info">
                            <span>${formattedDistance}</span>
                            <span>ÏïΩ ${Math.round(trail.distance / 3.6)}Î∂Ñ</span>
                        </div>
                        <div class="card-tags">
                            ${tagsHtml}
                        </div>
                    </div>
                `;
                trailListContainer.appendChild(card);
            });
        }

        function haversine(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
    </script>
</body>
</html>